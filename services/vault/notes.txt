8) „Done-Checkliste“ für Prod

Vault HCL für 3 Nodes 

Seed-Zerts pro Node (einmalig) + Start Vault.

Init+Unseal Node 1 (und 2/3) — oder Auto-Unseal aktivieren.

Bootstrap einmalig: Audit, Transit, PKI (Intermediate), Rollen, Policies, AppRoles (gehärtet).

Root-Token entziehen/wegschließen.

Vault Agent Sidecars je Service (AppRole Files rein, Template out).

Services auf HTTPS + interne DNS umstellen, CA-Trust setzen.

Healthchecks & depends_on sauber.

CRL/PKI Tidy Job einplanen.

Runbook: Unseal/Failover/Backup/Restore (Raft Snapshots).



git log:
ugrade to vault 1:20

todo:
tls reloader für die node module bauen. 

ai-opponent als service
-----
DONE bootstrap fertigstellen:

DONE pki rollen hinterfragen,

DONE dann certs issuen

DONE policies und approles fertigstellen. 

DONE: ca bei den agents placen. 
-----

DONE env. update in den services. 

DONE chown all docker-volumes 1000:1000


PENDING!!!

agents dont trust the cerrtificates

Alles klar — das Fehlerbild sagt: die Agents vertrauen der Server-CA nicht. Zwei Bausteine fehlen/stoßen zusammen:
	1.	CA-Datei muss wirklich im Agent-Container ankommen (richtiger Mount-Pfad).
	2.	Der Agent muss sie aktiv nutzen (per HCL vault { ca_cert = ... } oder via Env VAULT_CACERT), ohne VAULT_SKIP_VERIFY=1.

Deine Logs zeigen, dass die Agents nach wie vor gegen https://vault-1:8200 verbinden und mit unknown authority scheitern — also ist mindestens einer der zwei Punkte noch nicht erfüllt.

Quick, deterministic Fix (ohne Ratespiel)

A. Gemeinsame CA als Named Volume mounten
	•	Definiere ein gemeinsames Volume agent-ca und mounte es:
	•	in den Bootstrap-Container nach /agent/ca (dorthin schreibt das Skript die CA),
	•	in jeden Service-Agent (read-only) ebenfalls nach /agent/ca.
