services:
  web-application-firewall:
    build:
      context: ./services/web-application-firewall
      dockerfile: Dockerfile
    ports:
      - "8080:80"          # WAF wird auf Host‑Port 8080 verfügbar
    depends_on:
      - api-gateway
    networks:
      - api-network
    restart: always

  api-gateway:
    build: 
      context: .
      dockerfile: services/api-gateway/Dockerfile
    ports:
      - "3000:3000"          # Gate­way wird auf Host‑Port 3000 verfügbar
    depends_on:
      - auth-user-service
      - game-service
    environment:
      NODE_ENV: production
      LOG_LEVEL: ${LOG_LEVEL:-info} # Fallback 'info'
      GAME_SERVICE_UPSTREAM: http://game-service:3001
      AUTH_USER_SERVICE_UPSTREAM: http://auth-user-service:3002
    networks:
      - api-network
    volumes:
      - ./public:/app/public
    restart: always

  game-service:
    build: ./services/game-service
    environment:
      NODE_ENV: production
      LOG_LEVEL: ${LOG_LEVEL:-info}
      JWT_SECRET: ${JWT_SECRET}
    volumes:
      - ./database:/app/database
    networks:
      - api-network
    restart: always
  
  auth-user-service:
    build: ./services/auth-user-service
    environment:
      NODE_ENV: production
      LOG_LEVEL: ${LOG_LEVEL:-info}
      JWT_SECRET: ${JWT_SECRET}
    networks:
      - api-network
    restart: always
    volumes:
      - ./database:/app/database

networks:
  api-network:
    driver: bridge

volumes:
  database:
    driver: local